'use client';
import React, { useState, useRef,useEffect } from 'react'
import { useTheme } from "@/contexts/ThemeContext";
export default function TimelineDial() {
    const [angle, setAngle] = useState(0);
    const [isThrottled, setIsThrottled] = useState(false);
    const [isDragging, setIsDragging] = useState(false);
    const startAngleRef = useRef(0);
    const startPosRef = useRef({ x: 0, y: 0 });
    const currentAngleRef = useRef(0);
     const { theme } = useTheme();
        const svgContainerRef = useRef<SVGSVGElement | null>(null);
        const textContainerRef = useRef<HTMLDivElement | null>(null); // Text ke liye ref
    
        // SVG animation ke liye useEffect (Aapka code - NO CHANGES)
       
        useEffect(()=>{
            const svgEl = svgContainerRef.current;
             if (!svgEl) return;
       
              const circles = svgEl.querySelectorAll("circle");
              const lines = svgEl.querySelectorAll("line");
              const paths = svgEl.querySelectorAll("path");
              
              if(theme=="dystopia"){
                // Dark, ominous colors for dystopia
                circles.forEach(circle => {
                    circle.setAttribute("stroke", "#8B0000"); // Dark red
                });
                lines.forEach(line => {
                    line.setAttribute("stroke", "#4B0000"); // Darker red
                });
                paths.forEach(path => {
                    if(path.getAttribute("stroke")) {
                        path.setAttribute("stroke", "#8B0000"); // Dark red
                    }
                    if(path.getAttribute("fill")) {
                        path.setAttribute("fill", "#2D0000"); // Very dark red
                    }
                });
              }
              else if(theme=="utopia"){
                // Bright, hopeful colors for utopia
                circles.forEach(circle => {
                    circle.setAttribute("stroke", "#00CED1"); // Turquoise
                });
                lines.forEach(line => {
                    line.setAttribute("stroke", "#00BFFF"); // Deep sky blue
                });
                paths.forEach(path => {
                    if(path.getAttribute("stroke")) {
                        path.setAttribute("stroke", "#00CED1"); // Turquoise
                    }
                    if(path.getAttribute("fill")) {
                        path.setAttribute("fill", "#4169E1"); // Royal blue
                    }
                });
              }
        }, [theme])
    const throttleDelay = 1000;
    
    const rotate = (dir: number) => {
        setAngle((prev) => prev + dir * 60);
        currentAngleRef.current += dir * 60;
    };

    const handleWheel = (e: React.WheelEvent) => {
        e.preventDefault();
        if (isThrottled) return;

        let direction = 0;

        if (Math.abs(e.deltaX) > Math.abs(e.deltaY)) {
            direction = Math.sign(e.deltaX);
        } else if (Math.abs(e.deltaY) > 0) {
            direction = Math.sign(e.deltaY);
        }

        if (direction !== 0) {
            setIsThrottled(true);
            rotate(direction);
            setTimeout(() => {
                setIsThrottled(false);
            }, throttleDelay);
        }
    };

    // Calculate angle from center
    const getAngleFromCenter = (clientX: number, clientY: number, rect: DOMRect) => {
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        const deltaX = clientX - centerX;
        const deltaY = clientY - centerY;
        return Math.atan2(deltaY, deltaX) * (180 / Math.PI);
    };

    // Mouse drag handlers
    const handleMouseDown = (e: React.MouseEvent) => {
        if (isThrottled) return;
        setIsDragging(true);
        const rect = e.currentTarget.getBoundingClientRect();
        startAngleRef.current = getAngleFromCenter(e.clientX, e.clientY, rect);
        currentAngleRef.current = angle;
        e.preventDefault();
    };

    const handleMouseMove = (e: React.MouseEvent) => {
        if (!isDragging) return;
        const rect = e.currentTarget.getBoundingClientRect();
        const currentMouseAngle = getAngleFromCenter(e.clientX, e.clientY, rect);
        const deltaAngle = currentMouseAngle - startAngleRef.current;
        setAngle(currentAngleRef.current + deltaAngle);
    };

    const handleMouseUp = () => {
        if (isDragging) {
            setIsDragging(false);
            // Snap to nearest 60-degree increment
            const snappedAngle = Math.round(angle / 60) * 60;
            setAngle(snappedAngle);
            currentAngleRef.current = snappedAngle;
        }
    };

    // Touch handlers
    const handleTouchStart = (e: React.TouchEvent) => {
        if (isThrottled) return;
        setIsDragging(true);
        const touch = e.touches[0];
        const rect = e.currentTarget.getBoundingClientRect();
        startAngleRef.current = getAngleFromCenter(touch.clientX, touch.clientY, rect);
        currentAngleRef.current = angle;
    };

    const handleTouchMove = (e: React.TouchEvent) => {
        if (!isDragging) return;
        const touch = e.touches[0];
        const rect = e.currentTarget.getBoundingClientRect();
        const currentTouchAngle = getAngleFromCenter(touch.clientX, touch.clientY, rect);
        const deltaAngle = currentTouchAngle - startAngleRef.current;
        setAngle(currentAngleRef.current + deltaAngle);
        e.preventDefault();
    };

    const handleTouchEnd = () => {
        if (isDragging) {
            setIsDragging(false);
            // Snap to nearest 60-degree increment
            const snappedAngle = Math.round(angle / 60) * 60;
            setAngle(snappedAngle);
            currentAngleRef.current = snappedAngle;
        }
    };

    return (
        <div 
            className='absolute -bottom-[150px] mx-auto w-[300px] h-[300px] left-[calc(50%-150px)] bg-gradient-to-b from-transparent to-black to-50% from-40%' 
            onWheel={handleWheel}
            onMouseDown={handleMouseDown}
            onMouseMove={handleMouseMove}
            onMouseUp={handleMouseUp}
            onMouseLeave={handleMouseUp}
            onTouchStart={handleTouchStart}
            onTouchMove={handleTouchMove}
            onTouchEnd={handleTouchEnd}
            style={{ cursor: isDragging ? 'grabbing' : 'grab', touchAction: 'none' }}
        >
            <svg viewBox="0 0 538 538" fill="none" xmlns="http://www.w3.org/2000/svg" 
              ref={svgContainerRef}
            style={{
                width: '100%',
                height: '100%',
                transform: `rotate(${angle}deg)`,
                transitionDuration: isDragging ? '0s' : '1s',
                pointerEvents: 'none',
               
                
            }} className={`absolute top-0 left-0`}>
                <g clipPath="url(#clip0_1_4)">
                    <circle cx="269" cy="269" r="265" stroke="black" stroke-width="8" />
                    <circle cx="269" cy="269" r="192" stroke="black" stroke-width="8" />
                    <line x1="465" y1="265" x2="538" y2="265" stroke="black" stroke-width="8" />
                    <line y1="265" x2="73" y2="265" stroke="black" stroke-width="8" />
                    <path d="M406.961 38.06L367 104" stroke="black" stroke-width="8" />
                    <line x1="174.474" y1="439.982" x2="137.979" y2="503.951" stroke="black" stroke-width="8" />
                    <line x1="371.497" y1="436.059" x2="407.002" y2="500.022" stroke="black" stroke-width="8" />
                    <path d="M137.936 33.987L178.5 99.5" stroke="black" stroke-width="8" />
                    <path d="M65.6202 200.165L62.9651 208.63L37.9832 200.795L40.692 192.158C41.4699 189.678 42.6383 187.704 44.1971 186.237C45.7504 184.759 47.6086 183.833 49.7718 183.457C51.9351 183.082 54.3137 183.301 56.9079 184.114C59.5102 184.93 61.5947 186.116 63.1616 187.67C64.731 189.216 65.7315 191.053 66.1629 193.18C66.5969 195.299 66.416 197.627 65.6202 200.165ZM60.4689 202.877L61.6358 199.156C62.1816 197.416 62.3197 195.865 62.0502 194.503C61.7725 193.139 61.0911 191.965 60.0062 190.981C58.9131 189.995 57.411 189.203 55.5 188.603C53.5889 188.004 51.9113 187.799 50.4672 187.989C49.0149 188.177 47.7959 188.746 46.8101 189.696C45.8187 190.636 45.0578 191.951 44.5272 193.643L43.3182 197.497L60.4689 202.877Z" fill="black" />
                    <path d="M73.6174 178.171L71.4128 182.729L51.8581 163.029L54.408 157.759L81.9963 160.852L79.7916 165.409L58.011 162.64L57.9219 162.824L73.6174 178.171ZM64.4488 173.551L70.4615 161.122L73.8909 162.781L67.8782 175.21L64.4488 173.551Z" fill="black" />
                    <path d="M61.2448 144.534L64.2602 140.107L77.4385 141.333L77.5825 141.122L71.6151 129.308L74.6305 124.881L82.8358 141.993L90.9083 147.492L88.2456 151.401L80.1731 145.903L61.2448 144.534Z" fill="black" />
                    <path d="M97.2059 99.8735L115.735 118.372L112.384 121.728L97.121 106.491L97.0126 106.599L95.4546 113.697L92.3786 110.626L94.0176 103.067L97.2059 99.8735Z" fill="black" />
                    <path d="M466.604 333.535L468.575 324.885L494.102 330.702L492.091 339.527C491.514 342.061 490.507 344.122 489.07 345.709C487.639 347.306 485.861 348.378 483.735 348.925C481.608 349.472 479.22 349.443 476.569 348.839C473.91 348.233 471.737 347.218 470.051 345.794C468.364 344.378 467.22 342.627 466.62 340.541C466.018 338.463 466.013 336.128 466.604 333.535ZM471.522 330.421L470.656 334.223C470.251 336.001 470.237 337.558 470.614 338.894C471 340.232 471.773 341.348 472.933 342.241C474.101 343.137 475.661 343.807 477.614 344.252C479.567 344.697 481.256 344.767 482.68 344.463C484.113 344.16 485.282 343.495 486.189 342.469C487.102 341.454 487.756 340.082 488.15 338.353L489.047 334.414L471.522 330.421Z" fill="black" />
                    <path d="M460.387 356.096L462.221 351.378L483.285 369.454L481.164 374.911L453.417 374.03L455.251 369.311L477.183 370.333L477.257 370.142L460.387 356.096ZM469.895 359.97L464.893 372.839L461.342 371.459L466.344 358.59L469.895 359.97Z" fill="black" />
                    <path d="M475.404 388.639L472.752 393.293L459.517 393.122L459.391 393.344L466.282 404.644L463.629 409.298L454.085 392.895L445.599 388.058L447.941 383.949L456.427 388.785L475.404 388.639Z" fill="black" />
                    <path d="M443.121 436.027L423.176 419.066L426.248 415.453L442.678 429.424L442.777 429.307L443.764 422.108L447.075 424.924L446.045 432.589L443.121 436.027Z" fill="black" />
                    <path d="M229.019 53.3978L220.28 54.9292L215.761 29.1404L224.676 27.5781C227.236 27.1294 229.526 27.2602 231.546 27.9706C233.572 28.6711 235.249 29.8958 236.576 31.6446C237.904 33.3934 238.802 35.6068 239.272 38.2848C239.742 40.9711 239.647 43.3672 238.987 45.4731C238.335 47.5775 237.163 49.31 235.472 50.6706C233.789 52.0297 231.638 52.9388 229.019 53.3978ZM224.243 50.0684L228.084 49.3954C229.88 49.0806 231.322 48.4906 232.407 47.6254C233.491 46.7519 234.221 45.6073 234.596 44.1918C234.969 42.7679 234.983 41.0696 234.638 39.0968C234.292 37.124 233.703 35.54 232.87 34.3447C232.036 33.1411 230.971 32.3197 229.674 31.8808C228.384 31.4319 226.866 31.3605 225.12 31.6665L221.141 32.3638L224.243 50.0684Z" fill="black" />
                    <path d="M252.228 50.3954L247.167 50.5311L255.679 24.1115L261.532 23.9545L271.461 49.8793L266.4 50.0151L258.852 29.3976L258.647 29.4031L252.228 50.3954ZM252.118 40.129L265.92 39.7586L266.022 43.5669L252.221 43.9373L252.118 40.129Z" fill="black" />
                    <path d="M276.419 23.9505L281.737 24.5945L286.702 36.863L286.956 36.8937L294.707 26.1654L300.025 26.8095L288.596 41.96L287.422 51.6562L282.726 51.0875L283.9 41.3913L276.419 23.9505Z" fill="black" />
                    <path d="M314.542 57.1067L315.578 53.841L326.937 48.0958C328.031 47.5219 328.957 46.9976 329.715 46.5229C330.474 46.0482 331.088 45.5501 331.558 45.0284C332.027 44.5067 332.371 43.9006 332.59 43.2101C332.84 42.4221 332.875 41.6911 332.696 41.0172C332.519 40.3351 332.166 39.7405 331.639 39.2334C331.111 38.7263 330.449 38.3465 329.653 38.0939C328.833 37.8337 328.06 37.7762 327.334 37.9216C326.611 38.0588 325.981 38.382 325.444 38.8912C324.915 39.4029 324.515 40.0853 324.245 40.9383L319.943 39.5738C320.445 37.9897 321.244 36.7274 322.338 35.7869C323.432 34.8464 324.714 34.2563 326.185 34.0165C327.664 33.7793 329.228 33.9222 330.878 34.4453C332.551 34.9762 333.922 35.7554 334.991 36.7829C336.06 37.8104 336.771 38.9793 337.125 40.2895C337.486 41.6023 337.445 42.9573 337.002 44.3546C336.706 45.2889 336.236 46.1502 335.592 46.9385C334.949 47.7269 334.002 48.5264 332.752 49.3371C331.511 50.1503 329.834 51.0805 327.723 52.1274L322.034 55.1376L321.98 55.3082L332.849 58.7561L331.651 62.5337L314.542 57.1067Z" fill="black" />
                    <path d="M319.757 482.549L328.457 480.808L333.594 506.481L324.719 508.257C322.17 508.767 319.877 508.691 317.841 508.029C315.799 507.377 314.093 506.193 312.724 504.477C311.355 502.76 310.404 500.569 309.87 497.903C309.335 495.229 309.373 492.831 309.982 490.71C310.584 488.591 311.714 486.831 313.372 485.43C315.021 484.031 317.15 483.07 319.757 482.549ZM324.611 485.762L320.788 486.527C319 486.885 317.573 487.51 316.508 488.401C315.445 489.3 314.744 490.462 314.403 491.886C314.064 493.318 314.09 495.016 314.483 496.98C314.876 498.944 315.503 500.514 316.364 501.689C317.227 502.872 318.312 503.667 319.619 504.075C320.919 504.493 322.438 504.528 324.177 504.18L328.138 503.387L324.611 485.762Z" fill="black" />
                    <path d="M296.627 486.107L301.683 485.85L293.808 512.466L287.961 512.764L277.412 487.085L282.468 486.828L290.509 507.258L290.714 507.248L296.627 486.107ZM296.983 496.368L283.194 497.07L283 493.265L296.789 492.563L296.983 496.368Z" fill="black" />
                    <path d="M273.078 513.125L267.746 512.609L262.487 500.463L262.233 500.439L254.742 511.35L249.41 510.834L260.472 495.413L261.413 485.692L266.121 486.147L265.18 495.869L273.078 513.125Z" fill="black" />
                    <path d="M234.169 480.894L233.212 484.183L221.995 490.199C220.915 490.799 220.002 491.346 219.255 491.839C218.508 492.331 217.906 492.844 217.449 493.377C216.992 493.91 216.663 494.524 216.46 495.219C216.229 496.013 216.212 496.745 216.407 497.414C216.601 498.092 216.967 498.678 217.507 499.172C218.047 499.666 218.717 500.03 219.519 500.264C220.346 500.504 221.12 500.543 221.842 500.38C222.562 500.226 223.184 499.888 223.708 499.366C224.225 498.841 224.608 498.15 224.858 497.29L229.191 498.551C228.727 500.147 227.959 501.428 226.888 502.394C225.817 503.361 224.549 503.982 223.084 504.257C221.611 504.529 220.044 504.424 218.383 503.941C216.697 503.45 215.308 502.704 214.214 501.702C213.121 500.701 212.382 499.549 211.997 498.248C211.605 496.944 211.613 495.589 212.022 494.181C212.296 493.24 212.745 492.368 213.37 491.564C213.994 490.761 214.921 489.939 216.151 489.098C217.373 488.255 219.026 487.285 221.112 486.188L226.727 483.042L226.777 482.87L215.828 479.684L216.935 475.879L234.169 480.894Z" fill="black" />
                    <path d="M425.41 125.418L419.164 119.116L437.76 100.685L444.131 107.114C445.961 108.96 447.161 110.915 447.73 112.978C448.312 115.042 448.263 117.118 447.585 119.206C446.907 121.294 445.602 123.295 443.671 125.209C441.734 127.129 439.713 128.419 437.607 129.079C435.506 129.744 433.415 129.771 431.333 129.159C429.256 128.553 427.282 127.306 425.41 125.418ZM425.418 119.596L428.163 122.365C429.447 123.661 430.754 124.507 432.084 124.905C433.42 125.296 434.776 125.242 436.152 124.742C437.535 124.236 438.937 123.278 440.359 121.868C441.782 120.458 442.746 119.07 443.253 117.704C443.765 116.333 443.831 114.989 443.451 113.674C443.083 112.358 442.276 111.071 441.028 109.812L438.184 106.943L425.418 119.596Z" fill="black" />
                    <path d="M441.123 142.76L438.123 138.682L464.674 130.591L468.144 135.307L452.525 158.258L449.525 154.18L462.145 136.213L462.023 136.049L441.123 142.76ZM449.49 136.81L457.672 147.932L454.604 150.189L446.421 139.068L449.49 136.81Z" fill="black" />
                    <path d="M476.645 147.529L479.151 152.262L471.912 163.343L472.032 163.569L485.265 163.809L487.772 168.543L468.808 167.807L460.177 172.377L457.963 168.197L466.595 163.627L476.645 147.529Z" fill="black" />
                    <path d="M473.619 206.839C473.075 205.08 472.892 203.424 473.071 201.869C473.252 200.323 473.758 198.989 474.588 197.866C475.418 196.744 476.53 195.94 477.923 195.455L479.345 200.047C478.682 200.297 478.161 200.703 477.782 201.267C477.412 201.828 477.193 202.489 477.125 203.25C477.058 204.012 477.154 204.812 477.414 205.65C477.691 206.546 478.091 207.292 478.615 207.888C479.147 208.481 479.754 208.887 480.437 209.104C481.12 209.32 481.826 209.311 482.556 209.076C483.316 208.85 483.923 208.448 484.378 207.87C484.832 207.292 485.105 206.574 485.196 205.716C485.29 204.866 485.173 203.912 484.845 202.854L484.16 200.643L487.653 199.562L488.338 201.772C488.607 202.643 488.994 203.358 489.497 203.916C490.002 204.482 490.586 204.868 491.247 205.073C491.917 205.276 492.612 205.262 493.334 205.029C494.045 204.818 494.611 204.469 495.031 203.982C495.462 203.5 495.733 202.921 495.845 202.244C495.959 201.575 495.895 200.85 495.653 200.069C495.416 199.303 495.058 198.638 494.579 198.072C494.101 197.507 493.543 197.104 492.907 196.864C492.279 196.621 491.611 196.596 490.903 196.789L489.553 192.429C490.963 192.028 492.317 192.05 493.615 192.496C494.924 192.947 496.077 193.732 497.075 194.851C498.08 195.967 498.834 197.335 499.336 198.955C499.853 200.624 499.988 202.17 499.742 203.593C499.506 205.023 498.968 206.238 498.127 207.239C497.286 208.239 496.231 208.937 494.961 209.33C493.555 209.774 492.246 209.725 491.034 209.181C489.824 208.646 488.863 207.748 488.152 206.487L487.956 206.547C488.257 208.382 488.023 209.931 487.254 211.195C486.496 212.464 485.335 213.337 483.769 213.813C482.369 214.247 480.991 214.236 479.637 213.781C478.293 213.332 477.093 212.508 476.035 211.31C474.979 210.12 474.174 208.63 473.619 206.839Z" fill="black" />
                    <path d="M110.641 419.122L116.284 425.968L96.0803 442.621L90.3236 435.636C88.6703 433.63 87.6545 431.574 87.2763 429.467C86.8861 427.358 87.1243 425.296 87.9907 423.278C88.8571 421.261 90.3393 419.388 92.4373 417.658C94.5418 415.924 96.673 414.824 98.8307 414.36C100.983 413.89 103.068 414.054 105.086 414.854C107.098 415.647 108.95 417.07 110.641 419.122ZM110.101 424.918L107.621 421.91C106.461 420.502 105.237 419.54 103.949 419.022C102.654 418.51 101.298 418.44 99.882 418.812C98.4592 419.189 96.975 420.015 95.4295 421.289C93.884 422.563 92.7967 423.856 92.1676 425.17C91.5319 426.489 91.343 427.821 91.6009 429.166C91.8468 430.51 92.5335 431.865 93.661 433.233L96.2304 436.351L110.101 424.918Z" fill="black" />
                    <path d="M96.5809 400.414L99.1954 404.75L72.0151 410.378L68.9913 405.364L86.6447 383.939L89.2591 388.274L75.0482 405.01L75.1539 405.185L96.5809 400.414ZM87.7044 405.574L80.574 393.75L83.8364 391.783L90.9667 403.606L87.7044 405.574Z" fill="black" />
                    <path d="M61.6442 392.416L59.5813 387.472L67.8037 377.101L67.7053 376.865L54.5497 375.415L52.4868 370.472L71.3033 372.939L80.317 369.178L82.1387 373.543L73.125 377.305L61.6442 392.416Z" fill="black" />
                    <path d="M70.0836 333.632C70.4651 335.432 70.4956 337.099 70.1752 338.63C69.8531 340.153 69.2274 341.436 68.2981 342.477C67.3688 343.519 66.1882 344.218 64.7564 344.574L63.7605 339.871C64.4437 339.683 64.9996 339.325 65.4283 338.799C65.8486 338.274 66.1272 337.636 66.2641 336.884C66.4011 336.132 66.3786 335.327 66.1967 334.468C66.0025 333.551 65.6719 332.771 65.205 332.13C64.7297 331.49 64.162 331.031 63.502 330.752C62.8419 330.474 62.1376 330.418 61.3889 330.586C60.6117 330.741 59.9704 331.086 59.465 331.62C58.9595 332.154 58.6221 332.844 58.4528 333.69C58.2818 334.528 58.311 335.489 58.5406 336.573L59.02 338.836L55.443 339.594L54.9636 337.33C54.7747 336.438 54.4553 335.691 54.0056 335.089C53.5541 334.479 53.0084 334.042 52.3685 333.777C51.7203 333.513 51.0261 333.464 50.2858 333.63C49.5586 333.775 48.9635 334.071 48.5006 334.517C48.0275 334.957 47.7044 335.509 47.5314 336.173C47.3566 336.829 47.3539 337.557 47.5235 338.357C47.6894 339.141 47.9848 339.836 48.4096 340.443C48.8343 341.05 49.3526 341.502 49.9644 341.8C50.5678 342.099 51.2308 342.185 51.9531 342.058L52.8987 346.523C51.4575 346.793 50.1111 346.647 48.8594 346.085C47.5977 345.515 46.5212 344.628 45.63 343.423C44.7305 342.22 44.105 340.788 43.7536 339.129C43.3917 337.42 43.3984 335.868 43.7737 334.473C44.139 333.071 44.7862 331.911 45.7152 330.991C46.6442 330.071 47.7591 329.473 49.0598 329.198C50.5004 328.884 51.7995 329.053 52.9569 329.706C54.1125 330.349 54.987 331.332 55.5802 332.652L55.7803 332.61C55.6491 330.756 56.0239 329.235 56.9047 328.046C57.7755 326.851 59.0121 326.088 60.6148 325.758C62.0489 325.454 63.4194 325.591 64.7264 326.168C66.0233 326.738 67.1437 327.668 68.0877 328.958C69.0298 330.239 69.6952 331.797 70.0836 333.632Z" fill="black" />
                </g>
                <defs>
                    <clipPath id="clip0_1_4">
                        <rect width="538" height="538" fill="white" transform="matrix(0 1 1 0 0 0)" />
                    </clipPath>
                </defs>
            </svg>
            <div className='absolute top-0 left-0 h-full w-full flex justify-between'>

                <div className='w-1/3' onClick={()=>{rotate(-1)}}></div>
                <div className='w-1/3' onClick={()=>{rotate(1)}}></div>
            </div>
        </div>
    )
}
